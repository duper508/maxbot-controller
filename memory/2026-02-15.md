# 2026-02-15 - MaxBot Controller Deployment Progress

## Project Completion Summary
**MaxBot Controller** - Fallout Pip-Boy styled command center for ClawdBot
- Location: `/home/duper/clawd/clawdbot-controller`
- GitHub: `github.com/duper508/maxbot-controller` (public)
- Tech: Expo + Next.js monorepo, GitHub OAuth, Discord integration

## Session Work Completed

### Code & Infrastructure âœ…
- âœ… GitHub repo created and code pushed (clean history, no secrets)
- âœ… vercel.json configured for monorepo deployment
- âœ… `.env.import` template created with all 8 environment variables
- âœ… `.gitignore` updated to exclude `.env.import` (local secrets only)
- âœ… NEXTAUTH_SECRET generated: `I16zoWMI+P/ZYT1cfXzSUgk34zw9Tt2u3xIt4R9fFT8=`

### GitHub OAuth Setup âœ…
- âœ… OAuth App created: ID `Ov23liy0cOjWTjY6zqg8`
- âœ… GitHub PAT created with `public_repo` scope (read-only, for collaborator checks)
- Note: First created wrong type (GitHub App instead of OAuth App), corrected it

### Discord Integration âœ…
- âœ… Webhook created in #bot-controller-center
- âœ… Bot token collected

### Current Blocker ðŸ”´
**Vercel Deployment 404 Error**
- User deployed to Vercel, getting 404 error
- Root causes identified:
  1. Vercel Root Directory likely set to `apps/web` instead of `./`
  2. May be missing environment variables
  3. Build logs need to be checked

## `.env.import` Status (Local Only)
All 8 variables collected and stored locally (NEVER committed to GitHub):
1. GITHUB_ID: `Ov23liy0cOjWTjY6zqg8`
2. GITHUB_SECRET: (stored locally)
3. GITHUB_PAT: (stored locally, read-only scope)
4. NEXTAUTH_SECRET: `I16zoWMI+P/ZYT1cfXzSUgk34zw9Tt2u3xIt4R9fFT8=`
5. DISCORD_CHANNEL_ID: `1472555271166623775`
6. DISCORD_WEBHOOK_URL: (stored locally)
7. DISCORD_BOT_TOKEN: (user added)
8. NEXTAUTH_URL: (pending - will get from Vercel after 404 fixed)

## Key Decisions Made
- Named app **MaxBot-Controller** instead of ClawdBot for privacy
- GitHub OAuth chosen for authentication (vs Discord OAuth)
- GITHUB_PAT uses minimal `public_repo` scope (read-only)
- `.env.import` kept local for secret management
- Server-side API proxy pattern for all Discord operations

## Vercel Deployment - FINAL FIX IMPLEMENTED

### The 70ms Build Problem - ROOT CAUSE IDENTIFIED âœ…
- Vercel was completing build in 70ms with no output files
- **Root cause:** Using `builds` array triggers Vercel's **deprecated Legacy Builder** which silently fails
- Legacy Builder is incompatible with Next.js 13/14+ features (App Router, Server Components)

### Multiple Failed Attempts
1. Added `framework: nextjs` â†’ Ignored
2. Used `buildCommand` in vercel.json â†’ Ignored
3. Added `vercel-build` script â†’ Ignored
4. Used explicit `builds` array â†’ Silent failure (70ms)

### FINAL SOLUTION IMPLEMENTED âœ…
**vercel.json:**
```json
{
  "version": 2,
  "framework": null,
  "buildCommand": "cd apps/web && npm install && npm run build",
  "outputDirectory": "apps/web/.next"
}
```

Key changes:
- **Removed `builds` array** (was causing Legacy Builder)
- Set **`framework: null`** to force Vercel to execute buildCommand
- Explicit buildCommand with full path to apps/web

### Critical Additional Step
For full Next.js features (SSR, API routes) to work:
- Go to **Vercel Project Settings â†’ General â†’ Root Directory**
- Change to: `apps/web`
- Save

Without this, app builds but SSR routes won't work properly. With it, Vercel auto-detects Next.js and handles monorepo correctly.

### Status
- Fix committed and pushed (commit: a8b7c1e)
- Awaiting redeploy to test
- User should also change Root Directory setting in Vercel UI

### Key Learnings
1. **`builds` array is deprecated** - Vercel silently uses Legacy Builder, fails with no error
2. **`framework: null` forces buildCommand execution** - This is the workaround
3. **Root Directory in Vercel UI matters** - Setting to `apps/web` enables proper Next.js handling
4. **Monorepo on Vercel is non-obvious** - Requires understanding interaction between vercel.json and UI settings

## Important Notes
- Do NOT commit `.env.import` to GitHub (it's in .gitignore)
- Secrets are managed locally in `.env.import`
- Monorepo structure requires careful Vercel configuration
- NextAuth is strict about environment variables - missing even one causes issues
- GitHub Apps (Iv23...) vs OAuth Apps (Ov23...) - must be OAuth for NextAuth